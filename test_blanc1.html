<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Blanc 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }

        .question-card {
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .option-label {
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        /* Custom colors for feedback */
        .bg-custom-red {
            background-color: #fcebeb;
            border-color: #ef4444;
        }

        .bg-custom-green {
            background-color: #ecfdf5;
            border-color: #10b981;
        }

        .border-custom-red {
            border-color: #ef4444;
        }

        .border-custom-green {
            border-color: #10b981;
        }

        /* Style pour le menu de navigation */
        .nav-link {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            white-space: nowrap;
        }

        .nav-link:hover {
            background-color: #eef2ff;
            color: #4f46e5;
        }

        /* Styles pour la modal d'explication / message */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            animation: slide-down 0.3s ease-out;
        }

        @keyframes slide-down {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 flex justify-between items-center flex-wrap">
            <div>
                <h1 class="text-4xl font-bold text-gray-800 border-b-4 border-indigo-500 pb-2 inline-block">Quiz Test Blanc 1</h1>
                
            </div>
            <div class="flex items-center space-x-4 mt-4 md:mt-0">
                <!-- Bouton Réinitialiser l'Historique -->
                <button onclick="promptResetQuiz()"
                    class="px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition duration-150 shadow-md text-sm">
                    <span class="font-bold">↻</span> Réinitialiser le Quiz
                </button>

                <!-- Bouton Administration -->
                <button onclick="switchView('admin-view')"
                    class="px-4 py-2 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-800 transition duration-150 shadow-md text-sm">
                    Ajouter une explication
                </button>
            </div>
        </header>

        <!-- VUE DU QUIZ PRINCIPAL -->
        <div id="quiz-view">
            <!-- CONTEUR DE SCORE -->
            <div class="flex justify-center mb-6">
                <div id="score-display"
                    class="bg-indigo-100 text-indigo-800 text-xl font-bold py-3 px-6 rounded-lg shadow-inner">
                    Score: 0 / 0
                </div>
            </div>
            <!-- FIN DU CONTEUR DE SCORE -->

            <!-- MENU DE NAVIGATION -->
            <nav id="chapter-nav" class="mb-8 p-4 bg-white rounded-xl shadow-lg border border-gray-200">
                <h3 class="text-lg font-bold text-gray-700 mb-3">Accéder à un Chapitre :</h3>
                <div id="nav-links-container" class="flex flex-wrap gap-2 justify-center text-sm">
                    <!-- Les liens seront insérés ici par JavaScript -->
                </div>
            </nav>
            <!-- FIN DU MENU DE NAVIGATION -->

            <div id="quiz-container" class="space-y-6">
                <!-- Questions will be dynamically inserted here -->
            </div>
        </div>
        <!-- FIN DU QUIZ PRINCIPAL -->

        <!-- VUE D'ADMINISTRATION -->
        <div id="admin-view" class="hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 mt-4 mb-6 pb-2 border-b-2 border-gray-300">Panneau
                d'Administration</h2>

            <button onclick="switchView('quiz-view')"
                class="mb-6 px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                &larr; Retour au Quiz
            </button>

            <div id="admin-content" class="p-6 bg-white rounded-xl shadow-lg border border-gray-200">
                <!-- Le contenu de l'administration (liste des questions/éditeur) sera injecté ici -->
            </div>
        </div>
        <!-- FIN DE LA VUE D'ADMINISTRATION -->
    </div>

    <!-- Modal Général pour Explications et Messages -->
    <div id="message-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeMessageModal()">&times;</span>
            <h4 id="modal-title" class="text-2xl font-bold text-indigo-700 mb-4">Message</h4>
            <div id="modal-content-text" class="text-gray-700 space-y-3">
                <!-- Contenu du message ou de l'explication -->
            </div>
        </div>
    </div>
    <!-- Fin de la Modal -->

    <script>
        // =====================================================================================
        // VARIABLES ET DONNÉES GLOBALES
        // =====================================================================================

        let currentScore = 0;
        let totalQuestions = 0;
        let quizData = [];
        let userProgress = {};
        let currentlyEditingIndex = -1;

        const chapterBreaks = [
            { start: 0, title: "Test Blanc 1", anchor: "chapitre-0" },
            
        ];

        // Fonction pour obtenir les données initiales (Hardcoded)
        function getInitialQuizData() {
            return [
                 {
    question: "1-Which financial statement nodes are part of the calculation for net profit/loss?",
    type: "multiple",
    options: [
        "A. Financial Statement Notes",
        "B. Assets",
        "C. Not Assigned",
        "D. Liabilities and Equity"
    ],
    correct: [
        "B. Assets",
        "D. Liabilities and Equity"
    ],
    explanation:""
},
{
    question: "2-Why do you create a down-payment request for a customer?",
    type: "single",
    options: [
        "A. To inform the bank of a pending payment.",
        "B. To post the down-payment automatically.",
        "C. To update the general ledger.",
        "D. To report it on your P&L statement."
    ],
    correct: [
        "B. To post the down-payment automatically."
    ],
    explanation:""
},
{
    question: "3-The credit profile is used to store which information in the customer master data?",
    type: "multiple",
    options: [
        "A. The credit exposure",
        "B. The scoring rules",
        "C. The customer credit group",
        "D. The credit decisions"
    ],
    correct: [
        "B. The scoring rules",
        "C. The customer credit group"
    ],
    explanation: ""
},
{
    question: "4-A company wants to use the automatic payment program in SAP S/4HANA. Which configuration setting controls the document type used for payment postings?",
    type: "single",
    options: [
        "A. The bank determination settings, specifically the paying company codes section.",
        "B. The payment method settings, specifically the note to payee by origin section.",
        "C. The payment method setting, specifically the posting details section.",
        "D. The payment medium format settings, specifically the format output section."
    ],
    correct: [
        "C. The payment method setting, specifically the posting details section."
    ],
    explanation: ""
},
{
    question: "5-A fixed asset you ordered is delivered but is not activated. What could be the reason?",
    type: "single",
    options: [
        "A. The asset is only activated upon payment. It is a valuated goods receipt.",
        "B. The asset accountant did not enter the activation date in the asset master record",
        "C. The asset is only activated with the invoice. It is a non-valuated goods receipt",
        "D. The asset is only activated with the invoice. It is a valuated goods receipt."
    ],
    correct: [
        "C. The asset is only activated with the invoice. It is a non-valuated goods receipt"
    ],
    explanation: ""
},
{
    question: "6-Which tasks are mandatory before you can migrate data for a specific object?",
    type: "multiple",
    options: [
        "A. Predecessor objects have been migrated",
        "B. You select the same migration method previously used for other objects",
        "C. All previous migration projects are in the 'Finished' status",
        "D. Permission to migrate the data has been assigned"
    ],
    correct: [
        "A. Predecessor objects have been migrated",
        "D. Permission to migrate the data has been assigned"
    ],
    explanation: ""
},
{
    question: "7-When do you press the 'Read' button on the recording panel in a test automate?",
    type: "multiple",
    options: [
        "A. To capture a static label on the screen that should be checked during test execution",
        "B. To capture a value in a text field that should be stored as a variable",
        "C. To capture an error message on the screen that can be used later",
        "D. To capture text in a message screen that can be used for data binding later"
    ],
    correct: [
        "B. To capture a value in a text field that should be stored as a variable",
        "D. To capture text in a message screen that can be used for data binding later"
    ],
    explanation: ""
},
{
    question: "8-When do you specify the data retention period in the SAP S/4HANA Migration Cockpit?",
    type: "single",
    options: [
        "A. When the project status is 'Not Started'",
        "B. When the project status is 'Completed'",
        "C. When the project status is 'In Progress'",
        "D. When the project status is 'Finished'"
    ],
    correct: [
        "D. When the project status is 'Finished'"
    ],
    explanation: ""
},
{
    question: "9-What are some characteristics of the SAP S/4HANA Migration Cockpit?",
    type: "multiple",
    options: [
        "A. Mapping source values to SAP S/4HANA target values",
        "B. Extensibility using the Legacy System Migration Workbench",
        "C. Combining the local and remote schema approaches into one migration object",
        "D. Guidance and simulation of the migration process"
    ],
    correct: [
        "A. Mapping source values to SAP S/4HANA target values",
        "D. Guidance and simulation of the migration process"
    ],
    explanation: ""
},
{
    question: "10-Where are the manual test cases created for customer User Acceptance Testing?",
    type: "single",
    options: [
        "A. SAP Solution Manager",
        "B. SAP Cloud ALM",
        "C. SAP Signavio Process Navigator",
        "D. Test Automation Tool"
    ],
    correct: [
        "B. SAP Cloud ALM"
    ],
    explanation: ""
},
{
    question: "11-When using the Local SAP S/4HANA Database Schema migration approach, what is the maximum file size?",
    type: "multiple",
    options: [
        "A. 160 MB per file",
        "B. 160 MB per ZIP file",
        "C. 100 MB per ZIP file",
        "D. 100 MB per file"
    ],
    correct: [
        "C. 100 MB per ZIP file",
        "D. 100 MB per file"
    ],
    explanation: ""
},
{
    question: "12-When processing manual incoming payments, which options can be used to manage company payment differences?",
    type: "multiple",
    options: [
        "A. Individual value adjustment",
        "B. Return payment",
        "C. Residual payment",
        "D. Partial payment",
        "E. Payment on account"
    ],
    correct: [
        "C. Residual payment",
        "D. Partial payment",
        "E. Payment on account"
    ],
    explanation: ""
},
{
    question: "13-What does a partner line of business configuration expert reference when identifying business processes to cover in the Fit-to-Standard workshops?",
    type: "single",
    options: [
        "A. SAP Signavio Process Collaboration Hub",
        "B. Business Driven Configuration",
        "C. Digital Discovery Assessment",
        "D. SAP Signavio Journey Modeler"
    ],
    correct: [
        "C. Digital Discovery Assessment"
    ],
    explanation: ""
},
{
    question: "14-You post and match an incoming payment to the incorrect customer account. How can you correct the mistake?",
    type: "single",
    options: [
        "A. Change the customer on the payment document",
        "B. Reset the clearing and reverse the document",
        "C. Issue a credit memo to the customer",
        "D. Contact the customer through correspondence"
    ],
    correct: [
        "B. Reset the clearing and reverse the document"
    ],
    explanation: ""
},
{
    question: "15-Where can you customize the scope of a post-upgrade test?",
    type: "single",
    options: [
        "A. Test Your Processes app",
        "B. Manage Your Test Processes app",
        "C. Analyze Automated Test Results app",
        "D. Manage Upgrade Tests app"
    ],
    correct: [
        "D. Manage Upgrade Tests app"
    ],
    explanation: ""
},
{
    question: "16-Where can you access the Cloud Integration Automation Service (CIAS)?",
    type: "multiple",
    options: [
        "A. SAP Cloud ALM",
        "B. SAP for Me",
        "C. SAP Signavio Process Navigator",
        "D. SAP Discovery Center"
    ],
    correct: [
        "A. SAP Cloud ALM",
        "B. SAP for Me"
    ],
    explanation: ""
},
{
    question: "17-You migrated data from a legacy DB to SAP S/4HANA Cloud using a remote HANA DB. Which migration procedure did you use?",
    type: "multiple",
    options: [
        "A. Local SAP S/4HANA Database Schema",
        "B. Remote SAP HANA Database Schema",
        "C. Direct connection to an SAP system",
        "D. Migration using staging tables"
    ],
    correct: [
        "B. Remote SAP HANA Database Schema",
        "D. Migration using staging tables"
    ],
    explanation: ""
},
{
    question: "18-Which editing options are available in the dunning proposal list?",
    type: "multiple",
    options: [
        "A. Change the dunning charges",
        "B. Editing the dunning texts",
        "C. Edit dunning blocks at account level",
        "D. Edit dunning blocks at line item level",
        "E. Change the dunning level of an open item"
    ],
    correct: [
        "A. Change the dunning charges",
        "C. Edit dunning blocks at account level",
        "D. Edit dunning blocks at line item level"
    ],
    explanation: ""
},
{
    question: "19-In which type of extensibility is the SAP Business Technology Platform used to host a custom extension?",
    type: "single",
    options: [
        "A. Classic extensibility",
        "B. Key user extensibility",
        "C. Side-by-side extensibility",
        "D. Developer extensibility"
    ],
    correct: [
        "C. Side-by-side extensibility"
    ],
    explanation: ""
},
{
    question: "20-What does a launchpad page include?",
    type: "multiple",
    options: [
        "A. One or more apps",
        "B. One or more spaces",
        "C. One or more sections",
        "D. One or more catalogs"
    ],
    correct: [
        "A. One or more apps",
        "C. One or more sections"
    ],
    explanation: ""
},
{
    question: "21-When processing payments, what are possible functions of reason codes?",
    type: "multiple",
    options: [
        "A. Create a sales order",
        "B. Automatic posting of a residual item to a specific G/L account",
        "C. Control of the account where a residual item is posted",
        "D. Control of the type of payment notice sent to a customer",
        "E. Generate payment reminder"
    ],
    correct: [
        "B. Automatic posting of a residual item to a specific G/L account",
        "C. Control of the account where a residual item is posted",
        "D. Control of the type of payment notice sent to a customer"
    ],
    explanation: ""
},
{
    question: "22-How does an implementation consultant support customer experts during Fit-to-Standard?",
    type: "multiple",
    options: [
        "A. Conduct end-user training on active scope items",
        "B. Demonstrate SAP Best Practices business processes in the starter system",
        "C. Determine set up instructions for customer-driven integrations",
        "D. Highlight areas that require configuration or customization decisions"
    ],
    correct: [
        "B. Demonstrate SAP Best Practices business processes in the starter system",
        "D. Highlight areas that require configuration or customization decisions"
    ],
    explanation: ""
},
{
    question: "23-Based on the SAP Activate Methodology, which activities must you perform in the Explore phase?",
    type: "multiple",
    options: [
        "A. Conduct the Fit-to-Standard analysis to gather configuration values",
        "B. Conduct the Digital Discovery Assessment to identify extension requirements",
        "C. Use the Test system to demonstrate SAP Best Practices process",
        "D. Define the organizational structure and chart of accounts"
    ],
    correct: [
        "A. Conduct the Fit-to-Standard analysis to gather configuration values",
        "D. Define the organizational structure and chart of accounts"
    ],
    explanation: ""
},
{
    question: "24-You migrated data from a legacy DB to SAP S/4HANA Cloud using a remote HANA DB. Which data migration procedure did you use?",
    type: "multiple",
    options: [
        "A. Local SAP S/4HANA Database Schema",
        "B. Remote SAP HANA Database Schema",
        "C. Direct connection to an SAP system",
        "D. Migration using staging tables"
    ],
    correct: [
        "B. Remote SAP HANA Database Schema",
        "D. Migration using staging tables"
    ],
    explanation: ""
},
{
    question: "25-Which fields are maintained on the general data segment of the customer business partner?",
    type: "multiple",
    options: [
        "A. Communication language",
        "B. Bank key",
        "C. Payment method",
        "D. Company code"
    ],
    correct: [
        "A. Communication language",
        "B. Bank key"
    ],
    explanation: ""
},
{
    question: "26-What are the effects of a goods issue posting?",
    type: "multiple",
    options: [
        "A. It posts an accounting document",
        "B. It reduces the inventory values",
        "C. It generates an invoice for approval",
        "D. It increases the inventory value"
    ],
    correct: [
        "A. It posts an accounting document",
        "B. It reduces the inventory values"
    ],
    explanation: ""
},
{
    question: "27-You want to check why a down payment request was not generated for a purchase order item. Where would you check?",
    type: "multiple",
    options: [
        "A. The purchase order line item",
        "B. The purchase order header",
        "C. The goods receipt line item",
        "D. The invoice header"
    ],
    correct: [
        "A. The purchase order line item",
        "B. The purchase order header"
    ],
    explanation: ""
},
{
    question: "28-What can be transported with the Export Software Collection app?",
    type: "multiple",
    options: [
        "A. A custom form template",
        "B. A business configuration value",
        "C. A customer-specific CDS view",
        "D. A new organizational entity",
        "E. An adapted Fiori UI"
    ],
    correct: [
        "A. A custom form template",
        "C. A customer-specific CDS view",
        "E. An adapted Fiori UI"
    ],
    explanation: ""
},
{
    question: "29-Which statement is true regarding Situation Handling in SAP S/4HANA?",
    type: "single",
    options: [
        "A. Situation Handling is only applicable to financial operations.",
        "B. Situation Handling provides alerts for non-critical issues only.",
        "C. Situation Handling helps improve user efficiency by bringing critical issues to your attention at the right time.",
        "D. Situation Handling follows a manual approach for resolving issues."
    ],
    correct: [
        "C. Situation Handling helps improve user efficiency by bringing critical issues to your attention at the right time."
    ],
    explanation: ""
},
{
    question: "30-What is the relation between the entry view and the general ledger view of a journal entry?",
    type: "single",
    options: [
        "A. The general ledger view has as many or more line items as the entry view.",
        "B. The entry view has as many or more line items as the general ledger view.",
        "C. The general ledger view displays direct account assignments not available in the entry view.",
        "D. The entry view displays subledger accounts not available in the general ledger view."
    ],
    correct: [
        "A. The general ledger view has as many or more line items as the entry view."
    ],
    explanation: ""
},
{
    question: "31-Which dimension is used to produce external financial statements based on cost-of-sales accounting?",
    type: "single",
    options: [
        "A. Segment",
        "B. Market segment",
        "C. Functional area",
        "D. Profit center"
    ],
    correct: [
        "C. Functional area"
    ],
    explanation: ""
},
{
    question: "32-The Balance Sheet/Income Statement report can be exported to XLSX or PDF format.",
    type: "single",
    options: [
        "A. True",
        "B. False"
    ],
    correct: [
        "B. False"
    ],
    explanation: ""
},
{
    question: "33-Which fields can you define at the chart of accounts level of a G/L account?",
    type: "multiple",
    options: [
        "A. Account currency",
        "B. Account group",
        "C. G/L account type",
        "D. Functional area"
    ],
    correct: [
        "B. Account group",
        "C. G/L account type"
    ],
    explanation: ""
},
{
    question: "34-Which two-tier ERP scenario is used when finance runs on SAP S/4HANA Cloud Public Edition and other LoBs on Private Edition?",
    type: "single",
    options: [
        "A. Headquarter and Subsidiary",
        "B. Central Services",
        "C. Supply Chain Ecosystem"
    ],
    correct: [
        "B. Central Services"
    ],
    explanation: ""
},
{
    question: "35-Which solutions are included in the SAP Business Suite?",
    type: "multiple",
    options: [
        "A. SAP Business AI",
        "B. SAP Solution Manager",
        "C. SAP Business Data Cloud",
        "D. SAP Enterprise Central Component",
        "E. SAP cloud ERP applications"
    ],
    correct: [
        "A. SAP Business AI",
        "C. SAP Business Data Cloud",
        "E. SAP cloud ERP applications"
    ],
    explanation: ""
},
{
    question: "36-If you cannot find a prepackaged solution process for integration requirements, where would you look?",
    type: "single",
    options: [
        "A. SAP Signavio Process",
        "B. SAP Business Accelerator Hub",
        "C. SAP Business Technology Platform",
        "D. SAP Discovery Center",
        "E. SAP Cloud ALM"
    ],
    correct: [
        "B. SAP Business Accelerator Hub"
    ],
    explanation: ""
},
{
    question: "37-Who is responsible for delivering advisory, implementation, and application management services for cloud ERP?",
    type: "single",
    options: [
        "A. SAP only",
        "B. Partners",
        "C. End customers",
        "D. CIOs"
    ],
    correct: [
        "B. Partners"
    ],
    explanation: ""
},
{
    question: "38-Which elements belong to the configuration of a financial statement version?",
    type: "multiple",
    options: [
        "A. Currency",
        "B. FSV Item",
        "C. Accounts"
    ],
    correct: [
        "B. FSV Item",
        "C. Accounts"
    ],
    explanation: ""
},
{
    question: "39-Where can you launch the Quick Qualification?",
    type: "multiple",
    options: [
        "A. Known integrations",
        "B. Data volume to be migrated",
        "C. Legal entities",
        "D. Extensibility requirements",
        "E. Percentage of processes selected in a line of business"
    ],
    correct: [
        "A. Known integrations",
        "C. Legal entities",
        "E. Percentage of processes selected in a line of business"
    ],
    explanation: ""
},
{
    question: "40-What is the best definition of a semantic tag?",
    type: "single",
    options: [
        "A. A textual identifier used to highlight key figures in financial statement versions (FSVs).",
        "B. A calculation logic always developed by the business.",
        "C. A formula manually embedded into SAP reports."
    ],
    correct: [
        "A. A textual identifier used to highlight key figures in financial statement versions (FSVs)."
    ],
    explanation: ""
}



            ];
        }


        // =====================================================================================
        // FONCTIONS DE GESTION DE VUES ET DE DONNÉES
        // =====================================================================================

        function switchView(viewId) {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('admin-view').classList.add('hidden');

            document.getElementById(viewId).classList.remove('hidden');

            if (viewId === 'admin-view') {
                renderAdminPanel();
            }
        }

        // Utility function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Chargement du QuizData et du progrès utilisateur
        function loadQuizData() {
            // 1. Charger les questions
            const storedData = localStorage.getItem('quizData');
            if (storedData) {
                try {
                    quizData = JSON.parse(storedData);
                } catch (e) {
                    console.error("Erreur lors du chargement de localStorage (quizData). Utilisation des données par défaut.", e);
                    quizData = getInitialQuizData();
                }
            } else {
                quizData = getInitialQuizData();
            }

            // Randomize options for each question
            quizData.forEach(question => {
                if (question.options && Array.isArray(question.options)) {
                    shuffleArray(question.options);
                }
            });

            totalQuestions = quizData.length;

            // 2. Charger la progression utilisateur
            const storedProgress = localStorage.getItem('userProgress');
            if (storedProgress) {
                try {
                    userProgress = JSON.parse(storedProgress);
                } catch (e) {
                    console.error("Erreur lors du chargement de localStorage (userProgress). Réinitialisation de la progression.", e);
                    userProgress = {};
                }
            } else {
                userProgress = {};
            }
        }

        // Sauvegarde de la progression utilisateur
        function saveUserProgress() {
            localStorage.setItem('userProgress', JSON.stringify(userProgress));
        }

        // NOUVEAU: Fonction déclenchée par le bouton de réinitialisation pour afficher la confirmation
        function promptResetQuiz() {
            // Réinitialise la modal pour le contenu de confirmation
            const modalContentText = document.getElementById('modal-content-text');
            modalContentText.innerHTML = `
        <p class="text-lg font-semibold text-gray-800">Êtes-vous sûr de vouloir réinitialiser tout l'historique de vos réponses ?</p>
        <p class="text-red-600 mt-2">Cette action est <span class="font-bold">irréversible</span> et votre progression actuelle sera perdue.</p>
        <div id="modal-button-container" class="flex justify-end space-x-3 mt-6">
            <button onclick="closeMessageModal()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition font-medium">
                Annuler
            </button>
            <button onclick="resetQuizProgress()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
                Confirmer la Réinitialisation
            </button>
        </div>
    `;
            showMessageModal("Confirmation de Réinitialisation", modalContentText.innerHTML, false);
        }

        // NOUVEAU: Logique de réinitialisation après confirmation
        function resetQuizProgress() {
            closeMessageModal(); // Ferme la modal de confirmation

            localStorage.removeItem('userProgress');
            userProgress = {};
            currentScore = 0;

            // Redessine le quiz pour appliquer l'état initial
            renderQuiz();

            // Affiche une modal de succès
            showMessageModal(
                "Réinitialisation Effectuée",
                '<p class="text-green-600 font-semibold">L\'historique du quiz a été réinitialisé avec succès !</p>',
                true // Afficher le bouton de fermeture par défaut
            );
        }

        // =====================================================================================
        // LOGIQUE DU QUIZ
        // =====================================================================================

        function calculateScore() {
            let score = 0;
            quizData.forEach((q, qIndex) => {
                const progress = userProgress[qIndex];
                if (progress && progress.isCorrect) {
                    score++;
                }
            });
            return score;
        }

        function updateScoreDisplay() {
            currentScore = calculateScore();
            const scoreEl = document.getElementById('score-display');
            if (scoreEl) {
                scoreEl.textContent = `Score: ${currentScore} / ${totalQuestions}`;
            }
        }

        function renderChapterNav() {
            const navContainer = document.getElementById('nav-links-container');
            if (!navContainer) return;

            navContainer.innerHTML = '';

            chapterBreaks.forEach(chapter => {
                const link = document.createElement('a');
                link.href = `#${chapter.anchor}`;
                link.textContent = chapter.title.split(': ')[0];
                link.title = chapter.title;
                link.className = 'nav-link bg-indigo-50 text-indigo-700 font-semibold text-center shadow-sm';
                navContainer.appendChild(link);
            });
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            loadQuizData();
            updateScoreDisplay();
            renderChapterNav();

            let currentChapterIndex = 0;

            quizData.forEach((q, qIndex) => {
                const progress = userProgress[qIndex] || { answered: false, userSelections: [], isCorrect: false };

                // Ajouter le titre du chapitre si c'est le début d'un nouveau chapitre
                if (currentChapterIndex < chapterBreaks.length && chapterBreaks[currentChapterIndex].start === qIndex) {
                    const chapter = chapterBreaks[currentChapterIndex];
                    const chapterTitleHtml = `
                <h2 id="${chapter.anchor}" class="text-3xl font-extrabold text-indigo-700 mt-10 mb-4 pt-4 border-b-2 border-indigo-300">
                    ${chapter.title}
                </h2>
            `;
                    container.innerHTML += chapterTitleHtml;
                    currentChapterIndex++;
                }

                const questionHtml = `
            <div id="q-${qIndex}" class="question-card p-4 md:p-6 bg-white rounded-xl border border-gray-200 ${progress.answered ? (progress.isCorrect ? 'bg-custom-green border-custom-green' : 'bg-custom-red border-custom-red') : ''}">
                <p class="font-semibold text-gray-700 mb-4 text-lg">
                    ${qIndex + 1}. ${q.question}
                    ${q.type === 'multiple' ? '<span class="text-sm font-normal text-indigo-500 italic">(Plusieurs réponses possibles)</span>' : ''}
                </p>
                <div class="options-container space-y-3">
                    ${q.options.map((option, oIndex) => {
                    const isSelected = progress.userSelections.includes(option.trim());
                    const isDisabled = progress.answered;
                    const isCorrectOption = q.correct.includes(option.trim());

                    let labelClasses = 'option-label flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors duration-150 bg-white';

                    if (progress.answered) {
                        if (isSelected) {
                            labelClasses = isCorrectOption
                                ? 'bg-custom-green border-custom-green flex items-center p-3 rounded-lg border'
                                : 'bg-custom-red border-custom-red flex items-center p-3 rounded-lg border';
                        } else if (isCorrectOption) {
                            // Afficher la bonne réponse manquée
                            labelClasses = 'bg-custom-green border-dashed border-2 border-green-400 flex items-center p-3 rounded-lg border';
                        } else {
                            labelClasses = 'bg-white flex items-center p-3 rounded-lg border border-gray-200';
                        }
                    }

                    return `
                            <label for="q${qIndex}o${oIndex}" class="${labelClasses}">
                                <input 
                                    type="${q.type === 'single' ? 'radio' : 'checkbox'}" 
                                    id="q${qIndex}o${oIndex}" 
                                    name="q${qIndex}" 
                                    value="${option.trim()}" 
                                    class="form-${q.type === 'single' ? 'radio' : 'checkbox'} text-indigo-600 focus:ring-indigo-500 h-4 w-4"
                                    ${isSelected ? 'checked' : ''}
                                    ${isDisabled ? 'disabled' : ''}
                                >
                                <span class="ml-3 text-gray-800">${option}</span>
                            </label>
                        `;
                }).join('')}
                </div>
                <div class="flex flex-wrap gap-3 mt-4">
                    <button 
                        onclick="checkAnswer(${qIndex})" 
                        id="btn-${qIndex}" 
                        class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md disabled:opacity-50"
                        ${progress.answered ? 'disabled' : ''}
                    >
                        Vérifier la réponse
                    </button>
                    <button 
                        onclick="showExplanation(${qIndex})" 
                        id="exp-btn-${qIndex}" 
                        class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition duration-150 shadow-md"
                    >
                        Explication
                    </button>
                </div>
                <div id="feedback-${qIndex}" class="mt-3 text-sm font-medium ${progress.answered ? '' : 'hidden'}">
                    ${progress.answered ? (progress.isCorrect ? '<span class="text-green-600">Correct !</span>' : generateFeedbackHtml(qIndex, q, progress.userSelections)) : ''}
                </div>
            </div>
        `;
                container.innerHTML += questionHtml;
            });
        }

        function generateFeedbackHtml(qIndex, question, userSelections) {
            if (userProgress[qIndex] && userProgress[qIndex].isCorrect) {
                return '<span class="text-green-600">Correct !</span>';
            }

            const correctAnswersHtml = question.correct.map(answer =>
                `<span class="font-bold">${answer}</span>`
            ).join(' <span class="mx-1">&bull;</span> ');

            return `
        <span class="text-red-600">Faux. Veuillez revoir la réponse.</span>
        <div class="mt-2 p-2 bg-red-100 rounded-lg border border-red-300">
            <span class="font-semibold text-gray-800">Réponse(s) correcte(s) :</span>
            <p class="text-red-700">${correctAnswersHtml}</p>
        </div>
    `;
        }

        function checkAnswer(qIndex) {
            const question = quizData[qIndex];
            const questionEl = document.getElementById(`q-${qIndex}`);
            const optionsContainer = questionEl.querySelector('.options-container');
            const options = Array.from(optionsContainer.querySelectorAll(`input[name="q${qIndex}"]`));
            const checkButton = document.getElementById(`btn-${qIndex}`);

            if (checkButton.disabled) return;

            let userSelections = options
                .filter(input => input.checked)
                .map(input => input.value);

            // Vérification de la correction
            const isCorrect = question.correct.length === userSelections.length &&
                question.correct.every(val => userSelections.includes(val));

            // Mise à jour et sauvegarde de la progression
            userProgress[qIndex] = {
                answered: true,
                userSelections: userSelections,
                isCorrect: isCorrect
            };
            saveUserProgress();

            // Redessiner uniquement la question pour appliquer les classes et le feedback
            renderQuestion(qIndex);
            updateScoreDisplay();
        }

        // Fonction pour rendre une seule question (utilisée après la vérification)
        function renderQuestion(qIndex) {
            const question = quizData[qIndex];
            const progress = userProgress[qIndex] || { answered: false, userSelections: [], isCorrect: false };
            const questionEl = document.getElementById(`q-${qIndex}`);
            const checkButton = document.getElementById(`btn-${qIndex}`);
            const feedbackEl = document.getElementById(`feedback-${qIndex}`);

            // Appliquer les styles de carte
            questionEl.classList.remove('bg-custom-green', 'border-custom-green', 'bg-custom-red', 'border-custom-red', 'bg-white');
            questionEl.classList.add(progress.isCorrect ? 'bg-custom-green' : 'bg-custom-red');
            questionEl.classList.add(progress.isCorrect ? 'border-custom-green' : 'border-custom-red');

            // Afficher le feedback
            feedbackEl.innerHTML = generateFeedbackHtml(qIndex, question, progress.userSelections);
            feedbackEl.classList.remove('hidden');

            // Désactiver le bouton de vérification
            checkButton.disabled = true;

            // Mise à jour des options dans le DOM (pour les classes et désactivation)
            const optionsContainer = questionEl.querySelector('.options-container');
            const options = Array.from(optionsContainer.querySelectorAll(`input[name="q${qIndex}"]`));

            options.forEach(input => {
                const optionValue = input.value;
                const isCorrectOption = question.correct.includes(optionValue);
                const isSelected = input.checked;
                const label = input.closest('label');

                // Nettoyer les classes non persistantes
                label.classList.remove('bg-custom-green', 'border-custom-green', 'bg-custom-red', 'border-custom-red', 'bg-gray-50', 'bg-white', 'border-dashed', 'border-2', 'border-green-400');

                input.disabled = true;

                if (isSelected) {
                    label.classList.add(isCorrectOption ? 'bg-custom-green' : 'bg-custom-red');
                    label.classList.add(isCorrectOption ? 'border-custom-green' : 'border-custom-red');
                } else if (isCorrectOption) {
                    // Afficher la bonne réponse non sélectionnée si la réponse globale est fausse
                    if (!progress.isCorrect) {
                        label.classList.add('bg-custom-green', 'border-dashed', 'border-2', 'border-green-400');
                    }
                }
                if (!label.classList.contains('bg-custom-green') && !label.classList.contains('bg-custom-red')) {
                    label.classList.add('bg-white');
                }
            });

        }

        // =====================================================================================
        // LOGIQUE DE L'ADMINISTRATION
        // =====================================================================================

        function renderAdminPanel() {
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
        <h3 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">Liste des Questions</h3>
        <ul id="question-list" class="space-y-2 max-h-[60vh] overflow-y-auto p-2 bg-gray-50 rounded-lg">
            ${quizData.map((q, index) => `
                <li class="p-3 bg-white rounded-lg border border-gray-200 flex justify-between items-center hover:bg-indigo-50 cursor-pointer transition-colors duration-150">
                    <span class="text-sm font-medium text-gray-800 truncate">${index + 1}. ${q.question}</span>
                    <button 
                        class="text-xs px-3 py-1 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 font-semibold ml-4"
                        onclick="editQuestionExplanation(${index})"
                    >
                        Éditer
                    </button>
                </li>
            `).join('')}
        </ul>
        
        <div id="explanation-editor" class="mt-8 hidden">
            <!-- Le contenu de l'éditeur sera injecté ici lors de l'édition -->
        </div>
    `;
            // Assure que l'éditeur est caché initialement
            document.getElementById('explanation-editor').innerHTML = '';
        }

        function editQuestionExplanation(qIndex) {
            currentlyEditingIndex = qIndex;
            const question = quizData[qIndex];

            const editorHtml = `
        <h3 class="text-xl font-bold text-gray-700 mb-4">Éditer l'Explication de la Question ${qIndex + 1}</h3>
        <p id="editor-q-text" class="italic text-gray-600 mb-4 bg-gray-100 p-3 rounded-lg border border-gray-200">${question.question}</p>
        
        <label for="explanation-textarea" class="block text-sm font-medium text-gray-700 mb-2">Nouvelle Explication (Markdown accepté)</label>
        <textarea id="explanation-textarea" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">${question.explanation || ''}</textarea>
        
        <div class="flex flex-wrap gap-4 mt-4">
            <button 
                onclick="saveExplanation()" 
                id="save-exp-btn" 
                class="px-6 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition duration-150 shadow-md"
            >
                Sauvegarder
            </button>
            <button 
                onclick="renderAdminPanel()" 
                class="px-6 py-2 bg-gray-400 text-white font-medium rounded-lg hover:bg-gray-500 transition duration-150 shadow-md"
            >
                Annuler
            </button>
        </div>
    `;

            document.getElementById('explanation-editor').innerHTML = editorHtml;
            document.getElementById('explanation-editor').classList.remove('hidden');
            document.getElementById('question-list').classList.add('hidden');
            document.getElementById('admin-view').scrollTop = 0;
        }

        function saveExplanation() {
            if (currentlyEditingIndex === -1) {
                console.error("Aucune question sélectionnée pour la sauvegarde.");
                return;
            }

            const newExplanation = document.getElementById('explanation-textarea').value.trim();

            quizData[currentlyEditingIndex].explanation = newExplanation;

            // Persistance des questions mises à jour 
            localStorage.setItem('quizData', JSON.stringify(quizData));

            // Remplacement de window.alert() par une modal de succès
            showMessageModal(
                "Sauvegarde Effectuée",
                `<p class="text-green-600 font-semibold">Explication de la Question ${currentlyEditingIndex + 1} sauvegardée avec succès !</p>`,
                true
            );

            // Retour à la liste des questions
            currentlyEditingIndex = -1;
            renderAdminPanel();
            document.getElementById('question-list').classList.remove('hidden');
        }


        // =====================================================================================
        // LOGIQUE DE LA MODAL (UNIFIÉE POUR MESSAGES ET EXPLICATIONS)
        // =====================================================================================

        // NOUVEAU: Fonction pour afficher un message/explication dans la modal
        function showMessageModal(title, content, showCloseButton = true) {
            const modal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContentText = document.getElementById('modal-content-text');
            const closeBtn = modal.querySelector('.close-btn');

            modalTitle.textContent = title;
            modalContentText.innerHTML = content;

            // Gère l'affichage du bouton de fermeture (utile pour les confirmations)
            closeBtn.style.display = showCloseButton ? 'block' : 'none';

            // S'assurer que le bouton de fermeture par défaut est retiré s'il y a des boutons personnalisés
            if (modalContentText.querySelector('#modal-button-container')) {
                closeBtn.style.display = 'none';
            }

            modal.style.display = 'block';
        }

        // NOUVEAU: Fonction pour fermer la modal
        function closeMessageModal() {
            document.getElementById('message-modal').style.display = 'none';
            // Nettoyer les boutons de confirmation après fermeture
            const buttonContainer = document.getElementById('modal-content-text').querySelector('#modal-button-container');
            if (buttonContainer) buttonContainer.remove();
        }

        // Ancienne fonction showExplanation, mise à jour pour utiliser showMessageModal
        function showExplanation(qIndex) {
            const question = quizData[qIndex];
            const title = `Explication de la Question ${qIndex + 1}`;
            const content = `
        <p class="font-semibold text-lg text-gray-800 mb-2">${question.question}</p>
        <div class="bg-gray-100 p-3 rounded-lg border border-gray-200">
            <h5 class="font-bold text-indigo-600 mb-1">Détails:</h5>
            <p>${question.explanation ? question.explanation.replace(/\n/g, '<br>') : 'Aucune explication n\'est encore disponible pour cette question.'}</p>
        </div>
    `;
            showMessageModal(title, content);
        }


        // =====================================================================================
        // INITIALISATION
        // =====================================================================================

        document.addEventListener('DOMContentLoaded', () => {
            // Lie la fonction de fermeture de la modal au clic sur le bouton de fermeture
            document.getElementById('message-modal').querySelector('.close-btn').onclick = closeMessageModal;

            // Lie la fonction de fermeture de la modal au clic en dehors de la modal
            window.onclick = function (event) {
                const modal = document.getElementById('message-modal');
                if (event.target == modal) {
                    closeMessageModal();
                }
            }

            loadQuizData();
            renderQuiz();
            switchView('quiz-view');
        });
    </script>

</body>

</html>